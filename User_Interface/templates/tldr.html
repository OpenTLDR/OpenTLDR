<html>
<head>
    <title>OpenTLDR Report</title>
    <link href="{{ url_for('resources', path='/styles.css') }}" rel="stylesheet">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
</head>
<script>
    
    // This JavaScript fuction makes a REST call to OpenTLDR API to record feedback in KG

    function feedback_score_set (entry_id,rating){
        var formData = {
            feedback_entry_id : entry_id,
            feedback_rating : rating
        }
        $.ajax({
            url: "{{ url_for('set_feedback_rating')}}",
            async: true,
            type: 'POST',
            headers: {
            "Accept": "application/json",
            "Content-Type": "application/json"
            },
            data: JSON.stringify(formData),
            encode: true,
            success: function(data){
                console.log("Success: " + JSON.stringify(data));
            },
            error: function(data){
                console.log("ERROR: " + JSON.stringify(data));
            }
        });
    }
 </script>

<body>
    <h1>{{tldr.request_title}}</h1>
    
    <ul>
    {% for entry in tldr.entries %}
        <li><h2>{{entry.title}}</h2>
            
            <p>{{entry.summary}}</p>

            <form method="post" action="{{ url_for('set_feedback_rating')}}">
                <input type="hidden" name="feedback_entry_id" value="-1.0" />
                <input type="hidden" name="feedback_rating" value="unknown" />
            </form>

            Relevance:
            {% for score in [0.2, 0.4, 0.6, 0.8, 0.95] %}
                {% if entry.score >= score %}
                    <span onclick='feedback_score_set("{{entry.uid}}","{{score}}"); classList.add("selected");' class="fa fa-star checked"></span>
                {% else %}
                    <span onclick='feedback_score_set("{{entry.uid}}","{{score}}"); classList.add("selected");' class="fa fa-star-o unchecked"></span>
                {% endif %}
            {% endfor %}
            &nbsp;&nbsp;|&nbsp;&nbsp;
            <a href="{{ url_for('get_forwarding_to_content_link', tldr_entry_uid=entry.uid) }}"><span class="fa fa-external-link">&nbsp;source</span></a>

        </li>
        <br>

    {% endfor %}
    </ul>

    <div class="blurb">Generated by <a href="http://opentldr.org">OpenTLDR</a> for {{tldr.user}} on {{tldr.date}}.</div>

</body>
</html>